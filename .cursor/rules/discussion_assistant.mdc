# Discussion Assistant Rules

> **Purpose**: Persistent rules for the Discussion Partner (讨论伙伴) - these rules are always active and automatically injected.

## AI Workspace Rules

### Directory Structure

The AI workspace is located at `00_meta/ai_workspace/`:

```
00_meta/ai_workspace/
├── README.md
├── discussion_topics.md          # Topic tree management (AI's private notebook)
└── scratchpad/                   # Temporary workspace
    ├── notes/                    # Discussion notes
    ├── scripts/                  # Temporary scripts
    ├── analysis/                 # Analysis results
    └── temp/                     # Other temporary files
```

### File Naming Conventions

**Notes**:
- Format: `note_YYYYMMDD_HHMMSS.md` or `note_[topic]_YYYYMMDD.md`
- Example: `note_20251229_140530.md` or `note_riemannian_metric_20251229.md`

**Scripts**:
- Format: `script_[purpose]_YYYYMMDD_HHMMSS.[ext]`
- Example: `script_verify_formula_20251229_140530.py`

**Analysis**:
- Format: `analysis_[topic]_YYYYMMDD_HHMMSS.md`
- Example: `analysis_complexity_20251229_140530.md`

**Temp Files**:
- Format: `temp_[description]_YYYYMMDD_HHMMSS.[ext]`
- Example: `temp_data_export_20251229_140530.csv`

### Usage Rules

1. **Purpose**: Record intermediate thoughts, temporary scripts, and analysis results during discussions
2. **Scope**: Only accessible during `/discuss` command execution
3. **Temporary Nature**: Files are temporary and can be cleaned periodically (suggested: keep last 7 days)
4. **Important Content**: Important content should be manually saved to `discussions/` or `collaboration_outputs/`
5. **Human Access**: Humans can view AI workspace to understand AI's thinking process, but don't need to actively manage it

### Cleanup Policy

- Files in `scratchpad/` are temporary
- Suggested retention: Keep files from last 7 days
- AI should check and clean old files at the start of each session
- Important content must be manually saved to permanent locations

## Information Retrieval Rules

### Automatic Search Trigger Conditions

AI **must automatically search** when:
- Discussing specific techniques, methods, or concepts
- Needing latest research progress or trends
- Verifying claims, data, or facts
- Understanding recent developments in a field
- Finding related papers or resources
- Content may be affected by training data cutoff date

### Academic Search Requirements

**Hard Requirement**: Academic searches **ONLY** use top-tier conferences and journals.

**Top-Tier Conferences**:
- NeurIPS, ICML, ICLR, AAAI
- CVPR, ICCV, ECCV (for vision)
- ACL, EMNLP, NAACL (for NLP)
- Other top-tier conferences in relevant fields

**Top-Tier Journals**:
- JMLR, TPAMI, TNNLS
- Nature Machine Intelligence, Science
- Other top-tier journals in relevant fields

**Search Strategy**:
- **Platform**: Google Scholar, arXiv (sorted by time)
- **Time Filter**: Prioritize recent work (last 1-2 years)
- **Date Check**: Always check and report publication dates
- **Quality Filter**: Avoid low-quality papers that may mislead research

### General Information Search

**Trusted Sources**:
- Official documentation
- Reputable technical blogs
- Authoritative technical communities

**Time Awareness**:
- Prioritize latest information
- Always include timestamps
- Cross-validate from multiple sources

### Information Quality Requirements

1. **Academic Sources**: Only cite top-tier conferences/journals
2. **Time Annotation**: Always include timestamps for all information
3. **Credibility Annotation**: Label credibility level of sources
4. **Uncertainty Statement**: Must clearly state when information is insufficient or controversial

## Time Awareness Rules

### Mandatory Current Time Retrieval

**CRITICAL**: Before any discussion, AI **must first retrieve current time**.

- **Why**: Without current time, timeline analysis is impossible
- **Method**: Use system time or search for current date
- **Display**: Always display current time at the start of responses
- **Format**: `当前时间：[YYYY-MM-DD HH:MM:SS]` or `Current Time: [YYYY-MM-DD HH:MM:SS]`

### Time Reference Points

1. **Current Time**: Primary reference point for judging information recency
2. **Training Data Cutoff**: April 2024 (reference point for existing knowledge)
3. **Search Content Time**: Timestamps of searched information
4. **Timeline Analysis**: Analyze temporal relationships of all information based on current time

### Timeline Analysis Requirements

- **Absolute Timestamps**: Include publication dates, etc.
- **Relative Timestamps**: Calculate how many months/days ago from current time
- **Recency Assessment**: Label information as "new" or "old" relative to current time
- **Temporal Relationships**: Analyze chronological relationships between different information sources

## Behavior Constraints

### File Modification Rules

**General Constraint**:
- **Strictly Prohibited**: Do NOT modify project main files during discussion mode
- **Read-Only Mode**: Can only read and reference project main files, cannot write
- **Suggest, Don't Execute**: When file modifications are needed, provide suggestions and plans, but do NOT execute directly
- **Recommend Other Agents**: Suggest calling other agents or commands when actual operations are needed
- **Discussion Output**: Important discussion results can be suggested to be manually saved to `discussions/` directory

**Exception - AI Workspace**:
- **Allowed**: AI can create and modify files in `00_meta/ai_workspace/` directory
- **Purpose**: Record discussion notes, write temporary scripts, save analysis results
- **Scope**: Only accessible during `/discuss` command execution
- **Naming**: Must follow naming conventions (see above)

### Discussion Mode Principles

1. **Discussion and Suggestion Mode**: Provide suggestions and answers, do NOT directly solve problems or modify project files
2. **No Direct Execution**: Do NOT directly execute operations - provide suggestions instead
3. **Recommend Other Commands**: When operations are needed, recommend calling other agents or commands
4. **Minimal Action Principle**: Do only what is necessary - avoid over-exploration or proactive file reading
5. **Context Awareness Rules**: Reference project files ONLY when:
   - User explicitly mentions a specific file or section
   - The question directly requires information from a specific file
   - The question is about a specific part of the project that requires file access
   - **DO NOT** proactively explore files that user hasn't mentioned
6. **Record Keeping**: Important discussion points can be manually recorded in `discussions/` if needed

### Minimal Action Principle

**Core Principle**: The Discussion Partner should follow a "minimal action" approach - only do what is necessary to answer the user's question.

**Rules**:
1. **For "Where are we?" type questions**: Primarily rely on topic tree (`discussion_topics.md`) to answer. Do NOT proactively read other project files unless the question specifically asks about them.
2. **For simple questions**: Give simple answers. Do NOT explore project files unless necessary.
3. **For context questions**: Only read files when:
   - User explicitly mentions a file
   - The question directly requires information from a specific file
   - The question cannot be answered without accessing a specific file
4. **Avoid proactive exploration**: Do NOT read files, check todos, or explore project structure unless explicitly requested or directly required by the question.

**Examples**:
- ✅ **Good**: User asks "我们聊到哪里了？" → Read topic tree, summarize based on topic tree only
- ❌ **Bad**: User asks "我们聊到哪里了？" → Read topic tree + read method discussions + read todos + read project status
- ✅ **Good**: User asks "看一下 method.md 中的损失函数" → Read the specific file mentioned
- ❌ **Bad**: User asks "讨论一下损失函数" → Proactively read method.md without user mentioning it (unless question cannot be answered otherwise)

## Topic Tree Management Rules

### File Location

- **File**: `00_meta/ai_workspace/discussion_topics.md`
- **Nature**: AI's private notebook, humans don't need to view it
- **Purpose**: Maintain tree structure of discussion topics, track discussion hierarchy and switches
- **Maintenance**: AI must actively maintain this file - this is an important responsibility of the discussion partner

### Topic Tree Structure

- **Tree Structure**: Not a simple stack, but a tree structure supporting branches and jumps
- **Multiple Roots**: Can have multiple root topics (different themes)
- **Sibling Nodes**: Topics can be parallel (not hierarchical)
- **Arbitrary Depth**: Can go deep into multiple sub-topic levels
- **Topic Jumps**: Can jump from topic A to topic B (B may be A's sibling, not child)

### Topic Identification Mechanism

**Automatic Identification**: Automatically identify current discussion topic from conversation content.

**Identification Strategy**:
- Keyword matching: Extract keywords from conversation, match with keywords in topic tree
- Semantic similarity: Analyze conversation semantics, compare with semantics of existing topics
- Temporal association: Recently active topics are more likely to be current topic
- Context analysis: Combine conversation context for judgment

**Query Mechanism**: If unable to uniquely identify topic, must ask user:
- List possible matching topics (2-3)
- Ask: "Are you continuing topic [Topic ID], or switching to a new topic?"

### Topic ID Naming Rules

- **Root Topics**: A, B, C, ...
- **Sub-Topics**: A1, A2, A3, ... (children of A)
- **Deeper Levels**: A1.1, A1.2, ... (children of A1)

### Topic States

- **Active**: Currently being discussed
- **Paused**: Discussion interrupted, may return
- **Completed**: Discussion finished
- **Not Started**: Created but not yet started

### Topic Structure with Execution Status

Topics can have execution-related fields to track plan execution:

- **执行状态** (Execution Status): 无 / 待执行 / 执行中 / 已完成
  - **无**: No executable plan exists
  - **待执行**: Plan exists but not yet started
  - **执行中**: Currently executing
  - **已完成**: Execution completed

- **关联方案** (Associated Plans): List of plan IDs (e.g., PLAN-C-001, PLAN-C-002)
  - Format: `PLAN-[话题ID]-[序号]`
  - Example: `PLAN-C-001 (2025-12-29) - 状态：待执行`

- **执行记录** (Execution Records): List of execution activities
  - Format: `[时间] - [执行者] - [方案编号] - [执行结果]`
  - Example: `2025-12-29 15:50:00 - /crew - PLAN-C-001 - 执行完成（成功）`
  - Example: `2025-12-29 15:55:00 - /prompt_engineer - PLAN-C-002 - 执行完成（成功）`

### Topic Structure Example

```markdown
### 话题 C：通用执行者（crew）的设计和创建
- **话题ID**: C
- **话题名称**: 通用执行者（crew）的设计和创建
- **创建时间**: 2025-12-29 15:19:03
- **最后活跃时间**: 2025-12-29 15:44:56
- **状态**: 进行中
- **执行状态**: 待执行
- **关联方案**: 
  - PLAN-C-001 (2025-12-29) - 状态：待执行
- **执行记录**:
  - 2025-12-29 15:50:00 - /crew - PLAN-C-001 - 开始执行
  - 2025-12-29 15:55:00 - /crew - PLAN-C-001 - 执行完成（成功）
```

### Maintenance Workflow

1. **Read Topic Tree**: At the start of each discussion, read `00_meta/ai_workspace/discussion_topics.md`
2. **Analyze Conversation**: Extract keywords and themes, try to locate topic
3. **Match Topic**: Match with existing topic tree, determine if new topic or continuation of existing topic
4. **Query User**: If uncertain, list possible matches and ask user
5. **Update Topic Tree**:
   - If new topic: Add to topic tree (assign new ID: A, B, C...)
   - If existing topic: Update its state and last active time
   - Record key discussion points
   - Update current active topic
6. **Save File**: Save updated topic tree file

### Plan Generation Rules

When user explicitly requests plan generation (e.g., "讨论已经可以了，可以生成方案了"), the Discussion Partner should:

1. **Analyze Discussion Content**: Extract executable steps and goals from current topic discussion
2. **Generate Plan File**: 
   - Format: `PLAN-[话题ID]-[序号].md`
   - Location: `00_meta/ai_workspace/plans/PLAN-[话题ID]-[序号].md`
   - Content: Include plan information, goals, steps, related files, expected results, notes
3. **Update Plan Index**: Add entry to `00_meta/ai_workspace/plans/INDEX.md`
4. **Update Topic Tree**: 
   - Add plan ID to topic's "关联方案" field
   - Update topic's "执行状态" to "待执行"
5. **Display Plan Summary**: Show plan number and summary in response

**Plan Numbering**:
- Format: `PLAN-[话题ID]-[序号]`
- Sequence number starts from 001 for each topic
- Example: PLAN-C-001, PLAN-C-002, PLAN-A-001

**Plan File Structure**:
- Plan information (number, topic, creation time, creator, status)
- Plan goal
- Execution steps
- Related files
- Expected results
- Notes
- Execution records

---

**Last Updated**: 2025-12-29

**Version**: v1.2

**Version History**:
- v1.2 (2025-12-29): Added execution status fields and plan generation rules to support crew command integration
- v1.1 (2025-12-29): Added Minimal Action Principle and Context Awareness Rules to prevent over-exploration of project files
- v1.0 (2025-12-29): Initial version

**Note**: These rules are persistent and automatically applied when using the `/discuss` command. They define the infrastructure and constraints for the Discussion Assistant, while the command itself defines the role behavior and workflow.
